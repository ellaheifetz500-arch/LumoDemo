<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Lumo — Backoffice Assistant (Demo)</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      :root{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
      .fade-in{animation:fade .15s ease-in}
      @keyframes fade{from{opacity:.0;transform:translateY(2px)} to{opacity:1;transform:none}}
      .typing::after{content:""; display:inline-block; width:1.1ch; text-align:left; animation:dot 1s steps(3,end) infinite}
      @keyframes dot{0%{content:"."}33%{content:".."}66%{content:"..."}100%{content:"."}}
    </style>
    <!-- React UMD + Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-white text-neutral-900 antialiased">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef } = React;
      const STORAGE_KEY = "lumo.chat.v1";

      const btnOutline = "inline-flex items-center justify-center gap-2 px-3.5 h-10 rounded-xl border border-neutral-300 bg-transparent text-neutral-800 hover:bg-neutral-50 transition-colors disabled:opacity-50";
      const card = "rounded-2xl border border-neutral-200 shadow-sm overflow-hidden";

      function Avatar({ who }){
        const isUser = who === "user";
        const base = "flex items-center justify-center w-7 h-7 rounded-full text-[12px] font-semibold";
        return (
          <div className={base + " " + (isUser ? "bg-neutral-800 text-white" : "bg-neutral-200 text-neutral-800")}>
            {isUser ? "U" : "L"}
          </div>
        );
      }

      function Bubble({ role, children, onCopy }){
        const base = "max-w-[80%] w-fit rounded-2xl px-4 py-2 text-[15px] leading-6 fade-in";
        const isUser = role === "user";
        return (
          <div className={"flex items-start gap-2 " + (isUser ? "justify-end flex-row-reverse" : "justify-start")}>
            <Avatar who={isUser ? "user" : "lumo"} />
            <div className={(isUser ? base + " border border-neutral-300" : base + " bg-neutral-100")}>
              <div className="whitespace-pre-wrap">{children}</div>
              {!isUser && (
                <div className="mt-2 flex gap-3 text-xs text-neutral-500">
                  <button className="underline" onClick={onCopy}>Copy</button>
                </div>
              )}
            </div>
          </div>
        );
      }

      function useChatStore(){
        const [messages, setMessages] = useState(()=>{
          try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || null; } catch { return null; }
        });
        useEffect(()=>{
          if(!messages){
            const init = [{ role:"assistant", content:"Hi 👋 I’m Lumo. Ask anything about your operations — I’ll keep it simple. (English only)" }];
            setMessages(init);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(init));
          }
        }, []);
        useEffect(()=>{
          if(messages){
            const trimmed = messages.slice(-200);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(trimmed));
          }
        }, [messages]);
        function clear(){
          const init = [{ role:"assistant", content:"Hi 👋 I’m Lumo. Ask anything about your operations — I’ll keep it simple. (English only)" }];
          setMessages(init);
          localStorage.setItem(STORAGE_KEY, JSON.stringify(init));
        }
        return { messages, setMessages, clear };
      }

      // Friendly mock engine (demo-only; no server)
      function mockAnswer(q){
        const s = (q||"").toLowerCase();
        if(/inventory|stock|warehouse/.test(s)){
          const loc = s.includes("poland") ? "Poland" : s.includes("germany") ? "Germany" : s.includes("spain") ? "Spain" : s.includes("france") ? "France" : "our EU warehouses";
          const val = loc==="Poland"?4200:loc==="Germany"?8800:loc==="Spain"?2750:loc==="France"?3320:19000;
          return `Here’s a quick pulse:\n• Inventory in ${loc}: ${val.toLocaleString()} units.\nTip: say “trend” if you’d like a simple comparison.`;
        }
        if(s.includes("return")){
          const loc = s.includes("spain") ? "Spain" : s.includes("germany") ? "Germany" : s.includes("poland") ? "Poland" : "EU";
          const rate = loc==="Spain"?4.7:loc==="Germany"?3.3:loc==="Poland"?2.1:3.9;
          return `Return rate in ${loc} last week: **${rate}%**.\nWant to compare to last month?`;
        }
        if(s.includes("sla")){
          const c = (s.includes("germany")||s.includes("de")) ? "DE" : (s.includes("poland")||s.includes("pl")) ? "PL" : (s.includes("spain")||s.includes("es")) ? "ES" : "EU";
          const rate = c==="DE"?92:c==="PL"?95:c==="ES"?89:91;
          return `SLA check ✅  ${c}: **${rate}%**.\nIf this looks off, we can dig into carriers next.`;
        }
        if(s.includes("help")||s.includes("how")||s.includes("what can you do")){
          return "Try: “Show inventory for Poland”, “Return rate in Spain last week”, or “SLA in DE”. I’ll keep it short & clear.";
        }
        return "Here’s a quick answer. In the full version I can connect to your data and answer in real time.";
      }

      function App(){
        const { messages, setMessages, clear } = useChatStore();
        const [input, setInput] = useState("");
        const [typing, setTyping] = useState(false);
        const inputRef = useRef(null);
        if(!messages) return null;

        function send(textFromBtn){
          const text = (textFromBtn ?? input).trim();
          if(!text || typing) return;
          setInput("");

          const next = [...messages, { role:"user", content:text }];
          setMessages(next);
          setTyping(true);

          // small “thinking” delay for nicer feel
          setTimeout(()=>{
            const reply = mockAnswer(text);
            setMessages(m => [...m, { role:"assistant", content:reply }]);
            setTyping(false);
            setTimeout(()=>inputRef.current?.focus(), 0);
          }, 450);
        }
        const quick = (q)=> send(q);
        const copyText = (txt)=> navigator.clipboard.writeText(txt).catch(()=>{});

        return (
          <div className="min-h-screen">
            <div className="mx-auto max-w-3xl p-6 md:p-10">
              <header className="mb-6 flex flex-col gap-3 md:flex-row md:items-end md:justify-between">
                <div>
                  <h1 className="text-2xl md:text-3xl font-semibold tracking-tight">Lumo — Backoffice Assistant</h1>
                  <p className="text-sm md:text-base text-neutral-600 mt-1">Chat naturally. Lumo remembers your conversation on this device.</p>
                </div>
                <div className="flex items-center gap-2 flex-wrap">
                  <button className={btnOutline} onClick={()=>quick("What’s the return rate in Spain last week?")}>Quick demo</button>
                  <button className={btnOutline} onClick={()=>quick("Show inventory for Poland")}>Inventory (PL)</button>
                  <button className={btnOutline} onClick={()=>quick("SLA in DE")}>SLA (DE)</button>
                  <button className={btnOutline} onClick={clear}>Clear history</button>
                </div>
              </header>

              <div className={card}>
                <div className="p-4 md:p-6 flex flex-col gap-3 bg-white">
                  {messages.map((m,i)=>(
                    <Bubble key={i} role={m.role} onCopy={()=>copyText(m.content)}>{m.content}</Bubble>
                  ))}
                  {typing && (
                    <div className="flex items-start gap-2">
                      <Avatar who="lumo" />
                      <div className="rounded-2xl px-4 py-2 bg-neutral-100 text-[15px] leading-6 typing">Typing</div>
                    </div>
                  )}
                </div>

                <div className="border-t border-neutral-200 p-3 md:p-4 bg-white">
                  <div className="flex items-center gap-2">
                    <input
                      ref={inputRef}
                      value={input}
                      onChange={e=>setInput(e.target.value)}
                      onKeyDown={e=>e.key==="Enter" && send()}
                      placeholder="Type in English…"
                      className="flex-1 h-11 rounded-xl border border-neutral-300 px-3.5 outline-none focus:ring-4 focus:ring-neutral-200"
                    />
                    <button className={btnOutline+" h-11 px-4 font-medium"} onClick={()=>send()} disabled={typing}>
                      {typing ? "Thinking…" : "Send"}
                    </button>
                  </div>
                </div>
              </div>

              <p className="text-xs text-neutral-500 mt-4">
                Demo mode (no server). Later we can connect a serverless function for real answers.
              </p>
            </div>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
    </script>
  </body>
</html>
